{
  "name": "UBX-ESF-MEAS",
  "class_id": "0x10",
  "message_id": "0x02",
  "message_type": "input_output",
  "description": "External sensor fusion measurements. Contains sensor measurements with timestamp. Optionally, can include timestamp that the message was received at the receiver. Multiple measurements can be included in a single message. (1 measurement per sensor type.) See section Sensor data types in the integration manual for details.",
  "payload": {
    "length": {
      "variable": {
        "base": 8,
        "formula": "8 + flags.numMeas*4 + (flags.calibTtagValid ? 4 : 0)",
        "description": "Base length 8 bytes (timeTag, flags, id). Variable part is (numMeas * 4) bytes, where numMeas is bits 15-11 of the flags field. Additionally, 4 bytes are added if calibTtag is present (controlled by bit 3 of flags: calibTtagValid)."
      }
    },
    "fields": [
      {
        "name": "timeTag",
        "byte_offset": 0,
        "data_type": "U4",
        "unit": "ms",
        "description": "Time tag of measurement generated by external sensor"
      },
      {
        "name": "flags",
        "byte_offset": 4,
        "data_type": "X2",
        "description": "Flags. Set all unused bits to zero. Sub-fields: Bits 1-0 (U:2) timeMarkSent: Time mark signal was supplied (0=none, 1=on Ext0, 2=on Ext1). Bit 2 (U:1) timeMarkEdge: Trigger on rising (0) or falling (1) edge of time mark signal. Bit 3 (U:1) calibTtagValid: Calibration time tag available (0=not, 1=available). Bits 15-11 (U:5) numMeas: Number of measurements contained in this message (optional, can be obtained from message size)."
      },
      {
        "name": "id",
        "byte_offset": 6,
        "data_type": "U2",
        "description": "Identification number of data provider"
      },
      {
        "name": "data_measurements",
        "byte_offset": 8,
        "data_type": {
          "array_of": "X4",
          "count_field": "flags.numMeas"
        },
        "description": "Start of repeated group (numMeas times). Each X4 measurement contains: bits 23-0 (U:24) dataField (Data); bits 29-24 (U:6) dataType (Type of data (0=no data; 1..63=data type))."
      },
      {
        "name": "calibTtag",
        "byte_offset": null,
        "data_type": "U4",
        "unit": "ms",
        "optional": true,
        "description": "Start of optional group. Receiver local time calibrated. This field appears after the 'data_measurements' array. Its offset is dynamic, calculated as 8 + (flags.numMeas * 4) bytes from the start of the payload. This field must not be supplied when calibTtagValid (bit 3 of flags) is set to 0. (Note: manual states 'calibTtagValid' is always zero, but the explicit optional group implies it can be 1)."
      }
    ]
  }
}
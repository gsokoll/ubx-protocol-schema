{
  "name": "UBX-SEC-OSNMA",
  "class_id": "0x27",
  "message_id": "0x0a",
  "message_type": "periodic_polled",
  "description": "Information related to the execution of OSNMA protocol. Reports periodically the total number of satellites transmitting OSNMA data, the latest authenticated service status and configuration and the authentication results per satellite.",
  "payload": {
    "length": {
      "variable": {
        "base": 24,
        "formula": "24 + numberSVs * 4"
      }
    },
    "fields": [
      {
        "name": "version",
        "byte_offset": 0,
        "data_type": "U1",
        "description": "Message version (0x02 for this version)",
        "fixed_value": 2
      },
      {
        "name": "nmaHeader",
        "byte_offset": 1,
        "data_type": "X1",
        "description": "NMA header (status of the OSNMA service: NMA status, chain in force and CPKS)",
        "fields": [
          {
            "name": "headerAuth",
            "bit_offset": 0,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Indicates if the NMA header has been authenticated."
          },
          {
            "name": "nmaStatus",
            "bit_offset": 1,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Status of OSNMA service (as indicated by the Galileo system)",
            "values": [
              {
                "value": 0,
                "description": "Service status not authenticated yet"
              },
              {
                "value": 1,
                "description": "OSNMA service in test"
              },
              {
                "value": 2,
                "description": "OSNMA service operational"
              },
              {
                "value": 3,
                "description": "OSNMA service invalid, service not usable"
              }
            ]
          },
          {
            "name": "chainInForce",
            "bit_offset": 3,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Id of the TESLA chain in force"
          },
          {
            "name": "CPKS",
            "bit_offset": 5,
            "num_bits": 3,
            "data_type": "U3",
            "description": "TESLA chain and public key status",
            "values": [
              {
                "value": 0,
                "description": "Data is not applicable"
              },
              {
                "value": 1,
                "description": "Nominal"
              },
              {
                "value": 2,
                "description": "End of Chain (EOC), new DSM-KROOT is being transmitted"
              },
              {
                "value": 3,
                "description": "Chain revoked (CREV), a chain is or has been revoked"
              },
              {
                "value": 4,
                "description": "New public key (NPK), the public key in force is being renewed"
              },
              {
                "value": 5,
                "description": "Public key revocation (PKREV), the public key is or has been revoked"
              },
              {
                "value": 6,
                "description": "New Merkle tree (NMT), the Merkle tree is being renewed"
              },
              {
                "value": 7,
                "description": "Alert message (AM), OSNMA cryptographic data has been dropped. Connect to the GSC OSNMA server"
              }
            ]
          }
        ]
      },
      {
        "name": "osnmaMonitoring",
        "byte_offset": 2,
        "data_type": "X1",
        "description": "Monitoring information on OSNMA service as observed by the receiver",
        "fields": [
          {
            "name": "osnmaEnabled",
            "bit_offset": 0,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Flag that indicates whether OSNMA execution is enabled in the receiver"
          },
          {
            "name": "numberSVs",
            "bit_offset": 1,
            "num_bits": 5,
            "data_type": "U5",
            "description": "Number of SVs from which OSNMA data is being collected"
          },
          {
            "name": "nmaHeaderUpdate",
            "bit_offset": 6,
            "num_bits": 2,
            "data_type": "U2",
            "description": "New unauthenticated NMA header (NMA status, chain in force and CPKS) observed in the signal. Changes are pending on authentication. The authentication of the MAC and TESLA keys is discontinued until the new header has been authenticated",
            "values": [
              {
                "value": 0,
                "description": "Last observed NMA header is the same as the last authenticated header"
              },
              {
                "value": 1,
                "description": "New observed NMA header pending on authentication: Update still indicates a healthy service"
              },
              {
                "value": 2,
                "description": "New observed NMA header pending on authentication: Update indicates a problem in the service provision"
              }
            ]
          }
        ]
      },
      {
        "name": "timSyncReq",
        "byte_offset": 3,
        "data_type": "X1",
        "description": "Information related to OSNMA Time Synchronization requirement status",
        "fields": [
          {
            "name": "timSyncEnabled",
            "bit_offset": 0,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Flag that indicates if OSNMA must be executed applying the Time Synchronization requirement"
          },
          {
            "name": "timSyncStatus",
            "bit_offset": 1,
            "num_bits": 3,
            "data_type": "U3",
            "description": "Indicates if the time synchronization check has been applied.",
            "values": [
              {
                "value": 0,
                "description": "Time synchronization is not performed. Default to outside authentication epochs or when time synchronization is not requested"
              },
              {
                "value": 1,
                "description": "Time synchronization could not be performed, trusted time is not available"
              },
              {
                "value": 2,
                "description": "Time synchronization could not be performed, the trusted time is not accurate enough"
              },
              {
                "value": 3,
                "description": "Time synchronization check passed"
              },
              {
                "value": 4,
                "description": "Time synchronization check failed, replay attack"
              }
            ]
          },
          {
            "name": "reserved1",
            "bit_offset": 4,
            "num_bits": 4,
            "data_type": "X4",
            "reserved": true,
            "description": "Reserved"
          }
        ]
      },
      {
        "name": "timSyncReqDiff",
        "byte_offset": 4,
        "data_type": "I4",
        "description": "Time difference from the Time Synchronization requirement.\nThe time difference between the trusted input time and the decoded GSTpropagated to the current local time from the subframe that contains the TESLA key to be authenticated. Note that the time synchronization status must pass or fail (timSyncReq = 3/4). Otherwise, the the time difference cannot be computed",
        "unit": "ms"
      },
      {
        "name": "reserved0",
        "byte_offset": 8,
        "data_type": {
          "array_of": "U1",
          "count": 4
        },
        "description": "Reserved",
        "reserved": true
      },
      {
        "name": "dsmAuthentication",
        "byte_offset": 12,
        "data_type": "X4",
        "description": "Information related to the DSM authentication",
        "fields": [
          {
            "name": "dsmAuthenticationStatus",
            "bit_offset": 0,
            "num_bits": 6,
            "data_type": "U6",
            "description": "Indicates if the authentication of a Digital Signature Message has been performed",
            "values": [
              {
                "value": 0,
                "description": "No DSM authentication"
              },
              {
                "value": 1,
                "description": "DSM-KROOT authenticated, new status and configuration accepted"
              },
              {
                "value": 2,
                "description": "DSM-PKR authenticated, new public key accepted"
              },
              {
                "value": 3,
                "description": "OSNMA Alert message: All cryptographic data is dropped. Connect to GSC OSNMA server"
              },
              {
                "value": 4,
                "description": "DSM-KROOT authentication failed, new status and configuration is not accepted"
              },
              {
                "value": 5,
                "description": "DSM-PKR authentication failed, new public key is not accepted"
              },
              {
                "value": 6,
                "description": "Authentication not performed: DSM coded with unknown public key"
              },
              {
                "value": 7,
                "description": "Authentication not performed: Public key decompression failed"
              },
              {
                "value": 8,
                "description": "Authentication successful but new configuration is not supported"
              },
              {
                "value": 9,
                "description": "Authentication of a new public key during a NMT event cannot be performed. Missing future Merkle tree root"
              }
            ]
          },
          {
            "name": "hashFunction",
            "bit_offset": 6,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Last authenticated hash function that must be used"
          },
          {
            "name": "macFunction",
            "bit_offset": 8,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Last authenticated MAC function that must be used"
          },
          {
            "name": "pubKeyId",
            "bit_offset": 10,
            "num_bits": 4,
            "data_type": "U4",
            "description": "Last authenticated public key Id that must be used in ECDSA verification"
          },
          {
            "name": "macLookupTable",
            "bit_offset": 14,
            "num_bits": 8,
            "data_type": "U8",
            "description": "Last authenticated MAC Lookup table index"
          },
          {
            "name": "keySize",
            "bit_offset": 22,
            "num_bits": 4,
            "data_type": "U4",
            "description": "Last authenticated TESLA key size index"
          },
          {
            "name": "macSize",
            "bit_offset": 26,
            "num_bits": 4,
            "data_type": "U4",
            "description": "Last authenticated MAC size index"
          },
          {
            "name": "fromNVS",
            "bit_offset": 30,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Last authenticated configuration comes from NVS"
          },
          {
            "name": "reserved2",
            "bit_offset": 31,
            "num_bits": 1,
            "data_type": "X1",
            "reserved": true,
            "description": "Reserved"
          }
        ]
      },
      {
        "name": "teslaKey",
        "byte_offset": 16,
        "data_type": "X4",
        "description": "Information related to the TESLA key authentication",
        "fields": [
          {
            "name": "teslaKeyAuthStatus",
            "bit_offset": 0,
            "num_bits": 3,
            "data_type": "U3",
            "description": "Indicates if the authentication of an element of the TESLA key has been performed and the result thereof",
            "values": [
              {
                "value": 0,
                "description": "No TESLA key authentication performed"
              },
              {
                "value": 1,
                "description": "TESLA key successfully authenticated against the root key"
              },
              {
                "value": 2,
                "description": "TESLA key authentication against the root key has failed"
              },
              {
                "value": 3,
                "description": "TESLA key authentication on-going: Intermediate authentication step"
              },
              {
                "value": 4,
                "description": "TESLA key authentication is not performed: Key to authenticate is in the past. Potential replayed signals or simulation."
              }
            ]
          },
          {
            "name": "wnSf",
            "bit_offset": 3,
            "num_bits": 12,
            "data_type": "U12",
            "description": "The GST week number of the subframe in which the public key has been transmitted"
          },
          {
            "name": "towSf",
            "bit_offset": 15,
            "num_bits": 15,
            "data_type": "U15",
            "description": "Seconds of week of the GST of the subframe in which the public key has been transmitted divided by 30s (subframe length)"
          },
          {
            "name": "chainId",
            "bit_offset": 30,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Chain Id of the TESLA key that has been authenticated"
          }
        ]
      },
      {
        "name": "generalAndTiming",
        "byte_offset": 20,
        "data_type": "X4",
        "description": "Information related to the overall authentication process: Timing parameters and summary of data authenticated",
        "fields": [
          {
            "name": "authSVs",
            "bit_offset": 0,
            "num_bits": 6,
            "data_type": "U6",
            "description": "Total number of SVs for which orbit/clocks data authentication has been performed (ADKD types 0 or 12)"
          },
          {
            "name": "authNumTim",
            "bit_offset": 6,
            "num_bits": 6,
            "data_type": "U6",
            "description": "Total number of timing parameters authentications (typically one per SV sending MAC ADKD type 4)"
          },
          {
            "name": "timingAuthResult",
            "bit_offset": 12,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Indicates if the authentication of the timing parameters (GST-UTC and GST-GPS) has been performed and the result",
            "values": [
              {
                "value": 0,
                "description": "No timing parameters authentication performed"
              },
              {
                "value": 1,
                "description": "Timing parameters successfully authenticated"
              },
              {
                "value": 2,
                "description": "Timing parameters authentication failed"
              }
            ]
          },
          {
            "name": "macAdkdType",
            "bit_offset": 14,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Indicates if the receiver processes fast (1 subframe delay) or slow (10 subframes delay) MACS",
            "values": [
              {
                "value": 0,
                "description": "Fast MACS (ADKD type 0)"
              },
              {
                "value": 1,
                "description": "Slow MACS (ADKD type 12)"
              }
            ]
          },
          {
            "name": "pubKeySrc",
            "bit_offset": 15,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Origin of the public key",
            "values": [
              {
                "value": 0,
                "description": "Factory default"
              },
              {
                "value": 1,
                "description": "From satellites"
              },
              {
                "value": 2,
                "description": "From aided message"
              },
              {
                "value": 3,
                "description": "From NVS"
              }
            ]
          },
          {
            "name": "merkleRootSrc",
            "bit_offset": 17,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Origin of the Merkle tree root",
            "values": [
              {
                "value": 0,
                "description": "Factory default"
              },
              {
                "value": 2,
                "description": "From aided message"
              },
              {
                "value": 3,
                "description": "From NVS"
              }
            ]
          },
          {
            "name": "merkleRootVal",
            "bit_offset": 19,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Validity of the Merkle tree root currently applicable",
            "values": [
              {
                "value": 0,
                "description": "Merkle tree root is invalid"
              },
              {
                "value": 1,
                "description": "Merkle tree root is valid"
              }
            ]
          },
          {
            "name": "futureMerkleRootSrc",
            "bit_offset": 20,
            "num_bits": 2,
            "data_type": "U2",
            "description": "Origin of the future Merkle tree root",
            "values": [
              {
                "value": 0,
                "description": "Factory default"
              },
              {
                "value": 2,
                "description": "From aided message"
              },
              {
                "value": 3,
                "description": "From NVS"
              }
            ]
          },
          {
            "name": "futureMerkleRootVal",
            "bit_offset": 22,
            "num_bits": 1,
            "data_type": "U1",
            "description": "Validity of the future Merkle tree root",
            "values": [
              {
                "value": 0,
                "description": "Future Merkle tree root is invalid or unknown"
              }
            ]
          },
          {
            "name": "reserved3",
            "bit_offset": 23,
            "num_bits": 9,
            "data_type": "X9",
            "reserved": true,
            "description": "Reserved"
          }
        ]
      }
    ]
  }
}